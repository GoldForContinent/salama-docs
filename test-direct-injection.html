<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Direct HTML Injection Test</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/notifications-unified.css">
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .test-btn { padding: 10px 20px; margin: 10px; background: #006600; color: white; border: none; border-radius: 5px; cursor: pointer; }
        .test-btn:hover { background: #004400; }
    </style>
</head>
<body>
    <h1>Direct HTML Injection Test</h1>
    <p>This test injects notification HTML directly to verify modal works.</p>

    <button class="test-btn" onclick="injectNotifications()">Inject Test Notifications</button>
    <button class="test-btn" onclick="clearNotifications()">Clear All</button>
    <button class="test-btn" onclick="openModal()">Force Open Modal</button>

    <script>
        function injectNotifications() {
            const list = document.getElementById('notificationList');
            if (!list) {
                console.error('Notification list not found!');
                return;
            }

            // Clear existing content
            list.innerHTML = '';

            // Inject test notifications directly
            const testNotifications = [
                {
                    id: 1,
                    type: 'success',
                    message: 'Test notification 1 - Success message',
                    status: 'unread',
                    created_at: new Date().toISOString()
                },
                {
                    id: 2,
                    type: 'error',
                    message: 'Test notification 2 - Error message',
                    status: 'read',
                    created_at: new Date(Date.now() - 3600000).toISOString()
                },
                {
                    id: 3,
                    type: 'info',
                    message: 'Test notification 3 - Info message with longer text to test truncation and read more functionality',
                    status: 'unread',
                    created_at: new Date(Date.now() - 1800000).toISOString()
                }
            ];

            testNotifications.forEach(notif => {
                const itemHtml = createTestNotificationHtml(notif);
                list.innerHTML += itemHtml;
            });

            console.log('✅ Test notifications injected');
            console.log('List children count:', list.children.length);
            console.log('List HTML:', list.innerHTML);
        }

        function createTestNotificationHtml(notification) {
            const icons = {
                success: 'fas fa-check-circle',
                error: 'fas fa-exclamation-circle',
                warning: 'fas fa-exclamation-triangle',
                info: 'fas fa-info-circle'
            };

            const type = notification.type || 'info';
            const isUnread = notification.status === 'unread';
            const time = formatTime(notification.created_at);
            const hasAction = false; // Test without actions

            // Truncate message for preview
            const fullMessage = notification.message;
            const previewMessage = fullMessage.length > 100 ? fullMessage.substring(0, 100) + '...' : fullMessage;
            const shouldTruncate = fullMessage.length > 100;

            return `
                <div class="notification-modal-item ${type} ${isUnread ? 'unread' : ''}" data-id="${notification.id}">
                    <div class="notification-modal-item-selection">
                        <input type="checkbox" class="notification-checkbox" data-id="${notification.id}">
                    </div>
                    <div class="notification-modal-item-icon">
                        <i class="${icons[type] || icons.info}"></i>
                    </div>
                    <div class="notification-modal-item-content">
                        <p class="notification-modal-item-message ${shouldTruncate ? 'truncated' : ''}" data-full-message="${escapeHtml(fullMessage)}">
                            ${escapeHtml(previewMessage)}
                        </p>
                        ${shouldTruncate ? '<button class="notification-read-more" data-id="' + notification.id + '">Read more</button>' : ''}
                        <p class="notification-modal-item-time">${time}</p>
                    </div>
                    <div class="notification-modal-item-actions">
                        ${isUnread ? `
                            <button class="notification-modal-item-btn mark-read" title="Mark as read" data-id="${notification.id}">
                                <i class="fas fa-envelope-open"></i>
                            </button>
                        ` : `
                            <button class="notification-modal-item-btn mark-unread" title="Mark as unread" data-id="${notification.id}">
                                <i class="fas fa-envelope"></i>
                            </button>
                        `}
                        <button class="notification-modal-item-btn delete" title="Delete" data-id="${notification.id}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                    ${isUnread ? '<div class="notification-modal-item-unread-indicator"></div>' : ''}
                </div>
            `;
        }

        function formatTime(timestamp) {
            const now = new Date();
            const date = new Date(timestamp);
            const seconds = Math.floor((now - date) / 1000);

            if (seconds < 60) return 'Just now';
            if (seconds < 3600) return `${Math.floor(seconds / 60)}m ago`;
            if (seconds < 86400) return `${Math.floor(seconds / 3600)}h ago`;
            return date.toLocaleDateString();
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function clearNotifications() {
            const list = document.getElementById('notificationList');
            if (list) {
                list.innerHTML = '';
                console.log('✅ Notifications cleared');
            }
        }

        function openModal() {
            const modal = document.getElementById('notificationModal');
            if (modal) {
                modal.classList.add('active');
                modal.style.display = 'flex !important';
                modal.style.visibility = 'visible !important';
                modal.style.opacity = '1 !important';
                console.log('✅ Modal forced open');
            }
        }

        // Auto-open modal for testing
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(openModal, 1000);
        });
    </script>
</body>
</html>
